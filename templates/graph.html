<!doctype html>
<html>
<head>
    <title>{{ title }}</title>
    <script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
</head>
<body>

<script type="text/javascript">
  //Width and height
  var w = 750;
  var h = 500;
  var padding = 25;
  
  var dataset = [{{ data|safe }}];
  
  // Date functions
  var format = d3.time.format("%m/%d/%y");
  var dateFn = function(d) {return format.parse(d[0])};
  
  // Get min/max dates, maxweight for scales
  var maxdate = new Date();
  var mindate = new Date();
  var maxweight = 0;
  for (var i = 0; i < dataset.length; i++) {
    var d = dataset[i];
    var date = dateFn(d);
    if(date > maxdate)
      maxdate = date;
    if(date < mindate)
      mindate = date;
    if(d[1] > maxweight)
      maxweight = d[1];
  }

  //Create SVG element
  var svg = d3.select("body")
    .append("svg")
    .attr("width", w)
    .attr("height", h);

  // Scale x axis by date, y by weights
  var xScale = d3.time.scale()
    .domain([mindate, maxdate])
    .range([padding, w - padding * 2]);

  var yScale = d3.scale.linear()
    .domain([maxweight, 0])
    .range([padding, h - padding * 2]);

  // Add circles
  svg.selectAll("circle")
     .data(dataset)
     .enter()
     .append("circle")
     .attr("cx", function(d) {
       return xScale(format.parse(d[0]));
     })
     .attr("cy", function(d) {
       return yScale(d[1]);
      })
     .attr("r", 3)
     .attr("fill", "orange");

  // Add labels
  svg.selectAll("text")
     .data(dataset)
     .enter()
     .append("text")
     .text(function(d) {
       var date = format.parse(d[0])
       return (date.getMonth() + 1) + "/" + date.getDate();
     })
     .attr("x", function(d) {
       return xScale(format.parse(d[0]));
     })
     .attr("y", function(d) {
       return yScale(d[1]);
     })
     .attr("font-family", "monospace")
     .attr("font-size", "10px")
     .attr("fill", "black");

  // Add x axis, y axis
  var xAxis = d3.svg.axis().scale(xScale);
  svg.append("g").call(xAxis)
    .attr("font-family", "monospace")
    .attr("font-size", "10px");
  </script>

</body>
</html>
